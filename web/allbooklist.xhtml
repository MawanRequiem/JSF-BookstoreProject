<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      lang="en"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet name="https://fonts.googleapis.com/css?family=Montserrat"/>
    <link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/style.css"/>
    <h:outputScript name="https://code.jquery.com/jquery-3.7.1.min.js"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&amp;display=swap');
        html, body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #FFFFEF;
        }
        .book-item img {
            width: 180px;
        }
        #modal-img {
            width: 180px;
        }
        .out-of-stock {
            background-color: gray;
            pointer-events: none;
            cursor: not-allowed;
            position: relative;
            opacity: 0.6;
        }
        .out-of-stock::after {
            content: "SOLD OUT";
            color: red;
            font-size: 20px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px;
        }
        
        /* Hide PrimeFaces carousel pagination dots */
        .ui-carousel-page-links {
            display: none;
        }
        
    </style>
    <title>Tere Liye Bookstore</title>
</h:head>
<h:body>
    <ui:include src="header.xhtml"/>  
    <h:form id="bookForm">
                <div styleClass="carousel-main-div1" id="carousel1">
        <h1 class="heading"><span>Action</span></h1>
        <p:carousel value="#{bukuBean.getBooksByGenre('Action')}" var="buku" numVisible="6" circular="true" autoplayInterval="3000" styleClass="carousel-main">
            <p:panel styleClass="card-new">
                <h:graphicImage value="data:image/jpeg;base64,#{bukuBean.convertToBase64(buku.gambarBuku)}"
                                alt="#{buku.namaBuku}" style="width: 100%; height: 200px; object-fit: cover;" />
                <h3>#{buku.namaBuku}</h3>
                <p>Genre: #{buku.genreBuku}</p>
                <p>Stock: #{buku.stockBuku} item</p>
                <h4>Price: Rp #{buku.hargaBuku}</h4>
                <!-- Replace dialog with navigation to book details page -->
<h:commandLink value="View Details"
                   action="#{viewBookBean.loadBuku(buku.idBuku)}"
                   rendered="#{loginBean.username != null}"
                   onclick="window.location.href='bookDetails.xhtml?idBuku=#{buku.idBuku}'; return false;" />

    <!-- If user is not logged in, show login dialog -->
    <h:commandLink value="View Details"
                   rendered="#{loginBean.username == null}"
                   onclick="PF('loginDialog').show(); return false;" />
            </p:panel>
        </p:carousel>
                
                <h1 class="heading"><span>Adventure</span></h1>
                <p:carousel value="#{bukuBean.getBooksByGenre('Adventure')}" var="buku" numVisible="3" circular="true" autoplayInterval="3000" styleClass="carousel-main">
                    <p:panel styleClass="card-new">
                        <h:graphicImage value="data:image/jpeg;base64,#{bukuBean.convertToBase64(buku.gambarBuku)}"
                                        alt="#{buku.namaBuku}" style="width: 100%; height: 200px; object-fit: cover;" />
                        <h3>#{buku.namaBuku}</h3>
                        <p>Genre: #{buku.genreBuku}</p>
                        <p>Stock: #{buku.stockBuku} item</p>
                        <h4>Price: Rp #{buku.hargaBuku}</h4>
                        <!-- Replace dialog with navigation to book details page -->
<h:commandLink value="View Details"
                   action="#{viewBookBean.loadBuku(buku.idBuku)}"
                   rendered="#{loginBean.username != null}"
                   onclick="window.location.href='bookDetails.xhtml?idBuku=#{buku.idBuku}'; return false;" />

    <!-- If user is not logged in, show login dialog -->
    <h:commandLink value="View Details"
                   rendered="#{loginBean.username == null}"
                   onclick="PF('loginDialog').show(); return false;" />
                    </p:panel>
                </p:carousel>
                
                <h1 class="heading"><span>Fantasy</span></h1>
                <p:carousel value="#{bukuBean.getBooksByGenre('Fantasy')}" var="buku" numVisible="6" circular="true" autoplayInterval="3000" styleClass="carousel-main">
                    <p:panel styleClass="card-new">
                        <h:graphicImage value="data:image/jpeg;base64,#{bukuBean.convertToBase64(buku.gambarBuku)}"
                                        alt="#{buku.namaBuku}" style="width: 100%; height: 200px; object-fit: cover;" />
                        <h3>#{buku.namaBuku}</h3>
                        <p>Genre: #{buku.genreBuku}</p>
                        <p>Stock: #{buku.stockBuku} item</p>
                        <h4>Price: Rp #{buku.hargaBuku}</h4>
                        <!-- Replace dialog with navigation to book details page -->
<h:commandLink value="View Details"
                   action="#{viewBookBean.loadBuku(buku.idBuku)}"
                   rendered="#{loginBean.username != null}"
                   onclick="window.location.href='bookDetails.xhtml?idBuku=#{buku.idBuku}'; return false;" />

    <!-- If user is not logged in, show login dialog -->
    <h:commandLink value="View Details"
                   rendered="#{loginBean.username == null}"
                   onclick="PF('loginDialog').show(); return false;" />
                    </p:panel>
                </p:carousel>
                
                <h1 class="heading"><span>Family</span></h1>
                <p:carousel value="#{bukuBean.getBooksByGenre('Family')}" var="buku" numVisible="6" circular="true" autoplayInterval="3000" styleClass="carousel-main">
                    <p:panel styleClass="card-new">
                        <h:graphicImage value="data:image/jpeg;base64,#{bukuBean.convertToBase64(buku.gambarBuku)}"
                                        alt="#{buku.namaBuku}" style="width: 100%; height: 200px; object-fit: cover;" />
                        <h3>#{buku.namaBuku}</h3>
                        <p>Genre: #{buku.genreBuku}</p>
                        <p>Stock: #{buku.stockBuku} item</p>
                        <h4>Price: Rp #{buku.hargaBuku}</h4>
                        <!-- Replace dialog with navigation to book details page -->
<h:commandLink value="View Details"
                   action="#{viewBookBean.loadBuku(buku.idBuku)}"
                   rendered="#{loginBean.username != null}"
                   onclick="window.location.href='bookDetails.xhtml?idBuku=#{buku.idBuku}'; return false;" />

    <!-- If user is not logged in, show login dialog -->
    <h:commandLink value="View Details"
                   rendered="#{loginBean.username == null}"
                   onclick="PF('loginDialog').show(); return false;" />
                    </p:panel>
                </p:carousel>
                
                <h1 class="heading"><span>Romance</span></h1>
                <p:carousel value="#{bukuBean.getBooksByGenre('Romance')}" var="buku" numVisible="6" circular="true" autoplayInterval="3000" styleClass="carousel-main">
                    <p:panel styleClass="card-new">
                        <h:graphicImage value="data:image/jpeg;base64,#{bukuBean.convertToBase64(buku.gambarBuku)}"
                                        alt="#{buku.namaBuku}" style="width: 100%; height: 200px; object-fit: cover;" />
                        <h3>#{buku.namaBuku}</h3>
                        <p>Genre: #{buku.genreBuku}</p>
                        <p>Stock: #{buku.stockBuku} item</p>
                        <h4>Price: Rp #{buku.hargaBuku}</h4>
                        <!-- Replace dialog with navigation to book details page -->
<h:commandLink value="View Details"
                   action="#{viewBookBean.loadBuku(buku.idBuku)}"
                   rendered="#{loginBean.username != null}"
                   onclick="window.location.href='bookDetails.xhtml?idBuku=#{buku.idBuku}'; return false;" />

    <!-- If user is not logged in, show login dialog -->
    <h:commandLink value="View Details"
                   rendered="#{loginBean.username == null}"
                   onclick="PF('loginDialog').show(); return false;" />
                    </p:panel>
                </p:carousel>
                
            </div>

            <!-- PrimeFaces Dialog for Book Details -->

        </h:form>
    <p:dialog header="Login Required" widgetVar="loginDialog" modal="true" closable="false" draggable="false">
    <h:outputText value="Please log in to view book details." />

    <!-- Separate form for the dialog -->
    <h:form id="loginFormDialog">
        <!-- CommandButton with ajax disabled to allow full-page navigation -->
        <h:commandButton value="Login" action="login.xhtml?faces-redirect=true" styleClass="btn btn-primary" />
    </h:form>
</p:dialog>
    
    <ui:include src="footer.xhtml"/>


</h:body>
</html>